#!/bin/bash

sebal_engine_dir_path=/home/ubuntu/sebal-engine
sebal_engine_conf_path=$sebal_engine_dir_path/config/sebal.conf
sebal_engine_log_properties_path=$sebal_engine_dir_path/config/log4j.properties
sebal_engine_target_path=target/sebal-scheduler-0.0.1-SNAPSHOT.jar:target/lib
library_path=/usr/local/lib/
debug_port=4000

sudo java -Xdebug -Xrunjdwp:server=y,transport=dt_socket,address=$debug_port,suspend=n -Dlog4j.configuration=file:$sebal_engine_log_properties_path -Djava.library.path=$library_path -cp $sebal_engine_target_path/* org.fogbowcloud.sebal.engine.scheduler.SebalMain $sebal_engine_conf_path &

while [ true ]
do
  if (( $(ps -ef | grep -v grep | grep SebalMain | wc -l) > 0 ))
  then
    echo "Sebal Scheduler is still running"
  else
    echo "Sebal Scheduler is down. Starting it again..."
    sudo java -Xdebug -Xrunjdwp:server=y,transport=dt_socket,address=$debug_port,suspend=n -Dlog4j.configuration=file:$sebal_engine_log_properties_path -Djava.library.path=$library_path -cp $sebal_engine_target_path/* org.fogbowcloud.sebal.engine.scheduler.SebalMain $sebal_engine_conf_path &
  fi

  sleep 10m
done
